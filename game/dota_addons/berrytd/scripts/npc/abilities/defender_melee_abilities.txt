//a passive that toggles regen off when taking damage, then 
//switches it back on after %timeout
"ability_melee_defender_regen"
{
    "BaseClass"             "ability_datadriven"
    "AbilityBehavior"       "DOTA_ABILITY_BEHAVIOR_TOGGLE"
    "AbilityTextureName"    "witch_doctor_voodoo_restoration"      

    "precache"
    {
        "particle"  "particles/units/heroes/hero_oracle/oracle_purifyingflames.vpcf"
    }

    "OnToggleOn"
    {
        "ApplyModifier"
        {
            "ModifierName"  "modifier_melee_defender_regen"
            "Target"        "CASTER"            
        }
    }

    "OnToggleOff"
    {
        "RemoveModifier"
        {
            "ModifierName"  "modifier_melee_defender_regen"
            "Target"        "CASTER"
        }
    }

    "Modifiers"
    {
        "modifier_melee_defender_regen"
        {

            "Passive"           "0"         
            "IsPurgable"        "0"
            "IsBuff"            "1"
            "IsHidden"          "0"            

            "Properties"
            {               
                "MODIFIER_PROPERTY_HEALTH_REGEN_PERCENTAGE"   "%percent_regen"               
            }

            "OnCreated"
            {
                "AttachEffect"
                {
                    "Target" "CASTER"
                    "EffectName" "particles/units/heroes/hero_oracle/oracle_purifyingflames.vpcf"
                    "EffectAttachType" "follow_origin"           
                }
            }           
        }

        "modifier_melee_defender_dmg_check"
        {
            "Passive"   "1" 
            "IsHidden"  "1"
            //call a function that disables the regen for %cooldown
            "OnTakeDamage"    
            {
                "RunScript"
                {
                    "ScriptFile"        "unit_scripts/towers/ai_barracks.lua"
                    "Function"          "DisableRegen"

                    // "%attack_damage" is set to the damage value after mitigation
                    "Damage"            "%attack_damage"

                    "AbilityContext"
                    {
                        "Ability"       "ability_melee_defender_regen"
                        "Level"         "1"     
                        "Cooldown"      "%cooldown"
                    }
                } 
            }
        }
    }   

    "AbilitySpecial"
    {       
        "01"
        {
            "var_type"          "FIELD_FLOAT"
            "cooldown"          "10.0"
        }    

        "02"
        {
            "var_type"          "FIELD_INTEGER"
            "percent_regen"     "10"
        }         
    }   
} 